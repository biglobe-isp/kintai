@startuml

package api {

    class  AttendanceController <<Controller>> {
        + void command(String[] args)
        - void input(String date, String start, String end)
        - String total(String yearMonth)
    }
}

package service {

    class  AttendanceService <<Service>> {
        - AttendanceFactory attendanceFactory
        - AttendanceSummaryFactory attendanceSummaryFactory
        + void saveAttendance(LocalDate date, TimePoint startTime, TimePoint endTime)
        + AttendanceSummary fetchAttendanceSummary(YearMonth yearMonth)
    }

    ~class WorkMinuteCalculator <<Service>> {
        ~ WorkTimeOfDay calculateOfDay(TimePoint startTime, TimePoint endTime)
        ~ WorkTimeOfMonth calculateOfMonth(List<WorkTimeOfDay> workTimeOfDays)
    }
}

package datasource {

    class  AttendanceRepositoryCsv <<Datasource>> {
        - AttendanceFactory attendanceFactory
        + void save(Attendance attendance)
        + List<Attendance> fetchMonthly(YearMonth yearMonth)
    }

    class CsvSetting <<Setting>> {
        ~ String filepath
    }

    class FileIOHelper <<Component>> {
        ~ void writeLines(String filepath, List<String> lines)
        ~ List<String> readLines(String filepath)
    }

    class WorkRegulationRepositoryDefault <<Datasource>> {
        + WorkRegulation fetchDefault()
    }
}

package domain {

    class Attendance <<Entity>> {
        LocalDate date;
        TimePoint startTime;
        TimePoint endTime;
        WorkMinute workMinute;
        WorkMinute overWorkMinute;
        LocalDate createAt;
    }

    interface AttendanceRepository <<Service>> {
        + void save(Attendance attendance)
        + List<Attendance> fetchMonthly(YearMonth yearMonth)
    }

    class AttendanceSummary <<Entity>> {
        YearMonth yearMonth;
        WorkMinute totalWorkMinute;
        WorkMinute totalOverWorkMinute;
    }

    class AttendanceFactory <<Service>> {
        Attendance create(...)
    }

    class AttendanceSummaryFactory <<Service>> {
        AttendanceSummary create(...)
    }

    class TimePoint <<ValueObject>> {
        int hour
        int minute
        + int toMinuteValue()
        + int differenceMinuteValue(TimePoint timePoint)
        + boolean isBefore(TimePoint timePoint)
        + boolean isAfter(TimePoint timePoint)
    }

    class TimePointPair <<Entity>> {
        TimePoint startTime
        TimePoint endTime
    }

    class WorkMinute <<ValueObject>> {
        int value
    }

    class WorkRegulation <<Entity>> {
        TimePoint standardStartTime;
        TimePoint minStartTime;
        TimePoint maxStartTime;
        TimePoint standardEndTime;
        TimePoint minEndTime;
        TimePoint maxEndTime;
        ImmutableList<TimePointPair> restTimes;
        WorkMinute standardWorkMinute;
    }

    interface WorkRegulationRepository <<Service>> {
        + WorkRegulation fetchDefault()
    }

    interface WorkTimeOfDay {
        + WorkMinute getWorkMinute()
        + WorkMinute getOverWorkMinute()
    }

    interface WorkTimeOfMonth {
        + WorkMinute getTotalWorkMinute()
        + WorkMinute getTotalOverWorkMinute()
    }

    class YearMonth <<ValueObject>> {
        int year;
        int month;
    }
}


''' api
AttendanceController --> AttendanceService


''' service
AttendanceService --> AttendanceRepository
' AttendanceService --> AttendanceFactory
' AttendanceService --> AttendanceSummaryFactory
AttendanceService --> WorkMinuteCalculator
WorkMinuteCalculator --> WorkRegulationRepository
AttendanceFactory ..> Attendance : <<Create>>
AttendanceSummaryFactory ..> AttendanceSummary : <<Create>>
AttendanceFactory -[hidden]- WorkMinuteCalculator


''' datasource
AttendanceRepositoryCsv --|> AttendanceRepository
' AttendanceRepositoryCsv --> AttendanceFactory
AttendanceRepositoryCsv --> CsvSetting
AttendanceRepositoryCsv --> FileIOHelper
WorkRegulationRepositoryDefault --|> WorkRegulationRepository


''' domain
Attendance --|> WorkTimeOfDay
AttendanceSummary --|> WorkTimeOfMonth


''' placement order
WorkRegulationRepositoryDefault -[hidden] AttendanceRepositoryCsv
AttendanceRepositoryCsv -[hidden]- CsvSetting
CsvSetting -[hidden]- WorkRegulationRepository
WorkMinuteCalculator -[hidden]- WorkRegulationRepository
WorkRegulationRepository -[hidden] AttendanceRepository
AttendanceRepository -[hidden]- AttendanceFactory
AttendanceFactory -[hidden] AttendanceSummaryFactory

WorkRegulation -[hidden] Attendance
Attendance -[hidden] AttendanceSummary
WorkTimeOfDay -[hidden] WorkTimeOfMonth
WorkRegulation -[hidden]- TimePointPair
TimePointPair -[hidden]- TimePoint
TimePoint -[hidden] WorkMinute
WorkMinute -[hidden] YearMonth

@enduml
