<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:task="http://www.springframework.org/schema/task"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd
       ">

    <!-- ======================================================================
    |
    |    AmazonSQS の設定を記述（META-INF/aws/aws.xmlから読み込まれる）
    |
    =========================================================================== -->

    <beans profile="linkage">
        <!-- QueuePoller の生成 -->
        <bean id="queuePoller" class="jp.co.biglobe.lib.sqs_poller.publication.sqs.QueuePoller"
              factory-bean="queuePollerFactory" factory-method="build">
            <constructor-arg value="${aws.priority_queue_list}"/>
        </bean>

        <!-- タスクスケジューラの生成とタスク登録 -->
        <task:scheduler id="taskScheduler" pool-size="1"/>
        <task:scheduled-tasks scheduler="taskScheduler">
            <task:scheduled ref="queuePoller" method="poll" fixed-rate="30000"/>
        </task:scheduled-tasks>


        <!-- メッセージ自動削除処理  ** どちらか一方を選択する ** -->

        <!-- 例外の有無に関係なく、処理が完了したらメッセージを削除 -->
        <bean class="jp.co.biglobe.lib.sqs_poller.aop.AmazonSQSDeleteAdvice"/>
        <!-- 例外が発生したら、ロールバック（キューに戻す） -->
        <!--<bean class="jp.co.biglobe.lib.sqs_poller.aop.AmazonSQSCommitRollbackAdvice" />-->
    </beans>

</beans>
